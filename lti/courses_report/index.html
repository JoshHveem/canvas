<!doctype html>
<html>

<head>
  <title>Courses Report</title>
  <link rel="stylesheet" href="/canvas/lti/courses_report/style/main.css">
  <script src="/canvas/lti/cookies.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/print-js/1.5.0/print.js"></script>
</head>

<body>
  <div style="visibility: hidden;" id="canvas-courses-report-vue">
    <div v-if="loading">
      <span>Loading...</span>
    </div>
    <div v-else>
      <div
        style="position: sticky; width: 100%; background-color: #fff; z-index: 10; padding: 4px; box-sizing: border-box; box-shadow: 0px 5px 5px #888; margin-bottom: 1rem; top: 0;">
        <div style="display: inline-block;">
          Grade:
          <span class="btech-pill-text" :style="{'background-color': colors.red, 'color': '#fff'}">0-59%</span>
          <span class="btech-pill-text" :style="{'background-color': colors.yellow, 'color': '#fff'}">60-79%</span>
          <span class="btech-pill-text" :style="{'background-color': colors.green, 'color': '#fff'}">80-100%</span>
          <br>
          <br>
          SAP:
          <span class="btech-pill-text" :style="{'background-color': colors.red, 'color': '#fff'}">&gt;150%</span>
          <span class="btech-pill-text" :style="{'background-color': colors.yellow, 'color': '#fff'}">101-150%</span>
          <span class="btech-pill-text" :style="{'background-color': colors.green, 'color': '#fff'}">0-100%</span>
        </div>
        <div style="display: inline-block;">
          Submission History:
          <span class="btech-pill-text" :style="{'background-color': colors.red, 'color': '#fff'}">&gt;10 days</span>
          <span class="btech-pill-text" :style="{'background-color': colors.yellow, 'color': '#fff'}">7-9 days</span>
          <span class="btech-pill-text" :style="{'background-color': colors.green, 'color': '#fff'}">0-7 days</span>
          <br>
          <br>
          Course Enrollment:
          <span class="btech-pill-text" :style="{'background-color': colors.red, 'color': '#fff'}">&gt;180 days</span>
          <span class="btech-pill-text" :style="{'background-color': colors.yellow, 'color': '#fff'}">91-180 days</span>
          <span class="btech-pill-text" :style="{'background-color': colors.green, 'color': '#fff'}">0-90 days</span>
          <span class="btech-pill-text" :style="{'background-color': colors.complete, 'color': '#fff'}">Completed</span>
          <span class="btech-pill-text" :style="{'background-color': colors.gray, 'color': '#000'}">No Enrollment
            Found</span>
        </div>
        <div style="padding-top: 1rem;">
          <p><strong>DISCLAIMER: </strong>
          All data presented is an estimation and will NOT include submissions from the current day. Not intended for official use.</p>
          <p>Email Josh (jhveem@btech.edu) with any questions or suggestsions.</p>
        </div>
      </div>
      <div
        v-if="showCourse==='all'"
        >
        <div 
            v-for="course in json.courses_data.years['2020'].courses"
          >
          <div
            class="btech-data-container"
            v-if="(course.average_progress * 100) >= minProgress"
           >
            <div>
              <div
                @click="console.log(course); showCourse=course; openCourseReport();"
                class="btech-data-title"
                style="width: 20rem; display: inline-block; font-size: 1rem; cursor: pointer;">
                <strong>{{course.name}}</strong>
              </div>
              <div style="display: inline-block; width: 6rem; font-size: 1rem;">
                <span>Prog</span>
                <span 
                    class="btech-pill-text" 
                    :style="{
                      'background-color': colors.blue,
                      'color': colors.white,
                    }"
                  >
                  {{Math.round(course.average_progress * 100)}}%
                </span>
              </div>
              <div style="display: inline-block; width: 6rem; font-size: 1rem;">
                <span>Score</span>
                <span 
                    class="btech-pill-text" 
                    :style="{
                      'background-color': getBGColor(course.weighted_average_score, [60, 80]),
                      'color': colors.white,
                    }"
                  >
                  {{Math.round(course.weighted_average_score)}}%
                </span>
              </div>
              <div style="display: inline-block; width: 6rem; font-size: 1rem;">
                <span>Active</span>
                <span 
                  class="btech-pill-text" 
                  :style="{
                    'background-color': colors.blue,
                    'color': colors.white,
                  }">
                  {{course.enrollments.active.length}}
                </span>
              </div>
              <div style="display: inline-block; width: 6rem; font-size: 1rem;">
                <span>Dropped</span>
                <span 
                    class="btech-pill-text" 
                    :style="{
                      'background-color': getBGColor(1-(course.dropped / course.enrolled), [.8, .9]),
                      'color': colors.white,
                    }"
                  >
                  {{Math.round((course.enrollments.dropped.length / course.enrollments.completed) * 100)}}%
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div 
        v-show="showCourse !== 'all'" 
        id="printable-report" 
        class="btech-modal"
        style="display: inline-block; background-color: #fff; padding: 0.5rem; width: 800px;"
      >
        <!--Heading-->
        <div>
          <div class="btech-pill-text print-hide"
            :style="{'background-color': colors.red, 'color': '#fff', 'width': '1rem', 'float': 'right', 'text-align': 'center', 'cursor': 'pointer'}"
            @click="closeCourseReport()">
            X
          </div>
          <div class="btech-pill-text print-hide"
            title="You may have to enable printing background graphics for everything to appear."
            :style="{'background-color': colors.gray, 'color': '#000', 'width': '2.5rem', 'float': 'right', 'text-align': 'center', 'cursor': 'pointer'}"
            @click="print()">
            Print
          </div>
          <div
            class="btech-data-title"
          >
            <strong>{{showCourse.name}}</strong>
          </div>
        </div>
        <!--Submissions Graph-->
        <div id="btech-department-report-student-submissions-graph">Loading...</div>
        <!--Quizzes-->
        <div>
          <div
            class="btech-data-title"
          >
            <strong>Quizzes</strong>
          </div>
          <div
            v-for="(quiz, quiz_name) in showCourse.quizzes"
          >
          {{quiz.name}}
          Time: {{formatTime(quiz.average_duration)}}
          Score: {{Math.round(quiz.average_score / quiz.points_possible * 100)}}%
          Submissions: {{quiz.submission_count}}
          Alpha: {{calcAverageQuizAlpha(quiz)}}
          Difficulty: {{calcAverageQuizDifficulty(quiz)}}
          </div>

        </div>
      </div>
    </div>
  </div>
  <script>
    const CURRENT_DEPARTMENT = getCookie('currentDepartment');
    var scr = document.createElement('script'),
      head = document.head || document.getElementsByTagName('head')[0];
    scr.src = '/canvas/lti/courses_report/report.js';
    scr.async = false; // optionally

    head.insertBefore(scr, head.firstChild);
  </script>
</body>
</html>